---
sidebar_position: 90
title: Client guide
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Mocky Balboa client guide

Check out the examples below for some common use cases.

## Client

For full usage, see [API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Client).

### Registering a route handler

Registering a route handler allows you to intercept requests and modify the response in various ways via the [Route](#route) class passed as an argument to the handler.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
    ```TypeScript
    // Matching URL's with glob patterns
    client.route("**/api", (route) => {
        return route.fulfill(...);
    });

    // Matching URL's with regular expressions
    client.route(/^.*?\/api$/, (route) => {
        return route.fulfill(...);
    });

    // Matching URL's with a custom function
    client.route((url: URL) => {
        return url.pathname.startsWith("/api");
    }, (route) => {
        return route.fulfill(...);
    });
    ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
    ```JavaScript
    // Matching URL's with glob patterns
    client.route("**/api", (route) => {
        return route.fulfill(...);
    });

    // Matching URL's with regular expressions
    client.route(/^.*?\/api$/, (route) => {
        return route.fulfill(...);
    });

    // Matching URL's with a custom function
    client.route((url) => {
        return url.pathname.startsWith("/api");
    }, (route) => {
        return route.fulfill(...);
    });
    ```
  </TabItem>
</Tabs>

You can also register a route to handle _n_ times by specifying the `times` option:

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      // Once the route handler is matched 3 times it will be removed from the client
      client.route("**/api", (route) => {
        return route.fulfill(...);
      }, { times: 3 });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
      ```JavaScript
      // Once the route handler is matched 3 times it will be removed from the client
      client.route("**/api", (route) => {
        return route.fulfill(...);
      }, { times: 3 });
      ```
  </TabItem>
</Tabs>

[Client.route API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Client#route)

### Unregistering a route handler

If you want to disable a route handler, you can use the `unroute` method:

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
    ```TypeScript
    const routeHandlerId = client.route("**/api", (route) => {
        return route.fulfill(...);
    });

    client.unroute(routeHandlerId);
    ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
    ```JavaScript
    const routeHandlerId = client.route("**/api", (route) => {
        return route.fulfill(...);
    });

    client.unroute(routeHandlerId);
    ```
  </TabItem>
</Tabs>

[Client.unroute API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Client#unroute)

### Unregistering all route handlers

Used to unregister all route handlers registered on the client.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
    ```TypeScript
    client.unrouteAll();
    ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
    ```JavaScript
    client.unrouteAll();
    ```
  </TabItem>
</Tabs>

[Client.unrouteAll API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Client#unrouteAll)

### Waiting for a request

When you need to wait for a request to be made, you can use `client.waitForRequest`.

:::tip

Use `client.waitForRequest` to assert on the request being sent on the server.

:::

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
    ```TypeScript
    const requestPromise = client.waitForRequest("**/api");

    // Run code that triggers the request, i.e. loading a page

    // Await the request
    const request = await requestPromise;

    // Assert on the request
    expect(request.headers.get("Authorization")).toBeDefined();
    ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
    ```JavaScript
    const requestPromise = client.waitForRequest();

    // Run code that triggers the request, i.e. loading a page

    // Await the request
    const request = await requestPromise;

    // Assert on the request
    expect(request.headers.get("Authorization")).toBeDefined();
    ```
  </TabItem>
</Tabs>

[Client.waitForRequest API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Client#waitForRequest)

## Route

For full usage, see [API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Route).

### continue

Continue will execute the request on the client and pass the response back to the server.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      client.route("**/api", (route) => {
        return route.continue();
      });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
    ```JavaScript
    client.route("**/api", (route) => {
      return route.continue();
    });
    ```
  </TabItem>
</Tabs>

You can optionally override aspects of the request.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      client.route("**/api", (route) => {
        return route.continue({
          // Will override all request headers rather than extend them
          headers: {
            "X-Override": "value",
          },
        });
      });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
    ```JavaScript
    client.route("**/api", (route) => {
      return route.continue({
        // Will override all request headers rather than extend them
        headers: {
          "X-Override": "value",
        },
      });
    });
    ```
  </TabItem>
</Tabs>

[Route.continue API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Route#continue).

### error

Error will simulate a network level error causing `fetch` to throw an error.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      client.route("**/api", (route) => {
        return route.error();
      });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
      ```JavaScript
      client.route("**/api", (route) => {
        return route.error();
      });
      ```
  </TabItem>
</Tabs>

[Route.error API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Route#error).

### fallback

Fallback to the next route handler. If there are no more route handlers the request will default to [passthrough](#passthrough).

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      client.route("**/api", (route) => {
        return route.fallback();
      });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
      ```JavaScript
      client.route("**/api", (route) => {
        return route.fallback();
      });
      ```
  </TabItem>
</Tabs>

[Route.fallback API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Route#fallback).

### fetch

Similar to [continue](#continue) but will not pass the response back to the server. This is useful when you want to fetch the data from the remote server and modify the response before passing it back to the server.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      client.route("**/api", (route) => {
        const response = await route.fetch();
        response.headers.set("X-Custom-Header", "Value");
        return response;
      });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
      ```JavaScript
      client.route("**/api", (route) => {
        const response = await route.fetch();
        response.headers.set("X-Custom-Header", "Value");
        return response;
      });
      ```
  </TabItem>
</Tabs>

[Route.fetch API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Route#fetch).

### fulfill

Useful when you want to fixture the response with mock data. This allows you to fully control the response body, status, and headers.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      client.route("**/api", (route) => {
        return route.fulfill({
          status: 200,
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ hello: "world" }),
        });
      });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
      ```JavaScript
      client.route("**/api", (route) => {
        return route.fulfill({
          status: 200,
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ hello: "world" }),
        });
      });
      ```
  </TabItem>
</Tabs>

You can also fulfill the response with a file. Any file type is supported, allowing you to mock binary data. The content-type header (if not explicitly set) will be derived from the file extension using the [mime-types](https://www.npmjs.com/package/mime-types) package.

:::tip

Make sure to use absolute paths for the file path using the [path](https://nodejs.org/api/path.html) module.

:::

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      client.route("**/api", (route) => {
        return route.fulfill({
          path: "/path/to/file.json",
        });
      });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
      ```JavaScript
      client.route("**/api", (route) => {
        return route.fulfill({
          path: "/path/to/file.json",
        });
      });
      ```
  </TabItem>
</Tabs>

[Route.fetch API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Route#fetch).

### modifyReponse

Useful helper function when you want to modify the response before passing it back to the server, as with `route.fetch()`.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
        ```TypeScript
        client.route("**/api", (route) => {
        const response = await route.fetch();
        const responseJson = await response.json();

        // Add custom data field to the original response
        const modifiedResponse = client.modifiedResponse({
            body: JSON.stringify({
            ...responseJson,
            modified: true,
            }),
        });

        return modifiedResponse;
        });
        ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
      ```JavaScript
      client.route("**/api", (route) => {
      const response = await route.fetch();
      const responseJson = await response.json();

      // Add custom data field to the original response
      const modifiedResponse = client.modifiedResponse({
          body: JSON.stringify({
          ...responseJson,
          modified: true,
          }),
      });

      return modifiedResponse;
      });
      ```
  </TabItem>
</Tabs>

[Route.modifyResponse API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Route#modifyResponse).

### passthrough

Passthrough results in the request being fulfilled on the server over the network without any interference. This is the default behaviour when no route handlers are defined, or there is no match on the URL for any of the route handlers. It's also the fallback behaviour when the last matched route handler returns `route.fallback()`.

<Tabs groupId="javascript-language">
  <TabItem value="typescript" label="TypeScript" default>
      ```TypeScript
      client.route("**/api", (route) => {
        return route.passthrough();
      });
      ```
  </TabItem>
  <TabItem value="javascript" label="JavaScript">
      ```JavaScript
      client.route("**/api", (route) => {
        return route.passthrough();
      });
      ```
  </TabItem>
</Tabs>

[Route.passthrough API reference](https://api-reference.mockybalboa.com/classes/_mocky-balboa_client.Route#passthrough).
